//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/marcussmith/HambroPerks/hambroperks_org/libphonenumber/java/libphonenumber/src/main/java/com/google/i18n/phonenumbers/AsYouTypeFormatter.java
//

#include "J2ObjC_source.h"
#include "com/google/i18n/phonenumbers/AsYouTypeFormatter.h"
#include "com/google/i18n/phonenumbers/PhoneNumberUtil.h"
#include "com/google/i18n/phonenumbers/Phonemetadata.h"
#include "com/google/i18n/phonenumbers/internal/RegexCache.h"
#include "java/lang/Character.h"
#include "java/lang/Integer.h"
#include "java/lang/Math.h"
#include "java/lang/StringBuilder.h"
#include "java/util/ArrayList.h"
#include "java/util/Iterator.h"
#include "java/util/List.h"
#include "java/util/regex/Matcher.h"
#include "java/util/regex/Pattern.h"

@interface ComGoogleI18nPhonenumbersAsYouTypeFormatter () {
 @public
  NSString *currentOutput_;
  JavaLangStringBuilder *formattingTemplate_;
  NSString *currentFormattingPattern_;
  JavaLangStringBuilder *accruedInput_;
  JavaLangStringBuilder *accruedInputWithoutFormatting_;
  jboolean ableToFormat_;
  jboolean inputHasFormatting_;
  jboolean isCompleteNumber_;
  jboolean isExpectingCountryCallingCode_;
  ComGoogleI18nPhonenumbersPhoneNumberUtil *phoneUtil_;
  NSString *defaultCountry_;
  ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *defaultMetadata_;
  ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *currentMetadata_;
  jint lastMatchPosition_;
  jint originalPosition_;
  jint positionToRemember_;
  JavaLangStringBuilder *prefixBeforeNationalNumber_;
  jboolean shouldAddSpaceAfterNationalPrefix_;
  NSString *extractedNationalPrefix_;
  JavaLangStringBuilder *nationalNumber_;
  id<JavaUtilList> possibleFormats_;
  ComGoogleI18nPhonenumbersInternalRegexCache *regexCache_;
}

- (ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *)getMetadataForRegionWithNSString:(NSString *)regionCode;

- (jboolean)maybeCreateNewTemplate;

- (void)getAvailableFormatsWithNSString:(NSString *)leadingDigits;

- (jboolean)isFormatEligibleWithNSString:(NSString *)format;

- (void)narrowDownPossibleFormatsWithNSString:(NSString *)leadingDigits;

- (jboolean)createFormattingTemplateWithComGoogleI18nPhonenumbersPhonemetadata_NumberFormat:(ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat *)format;

- (NSString *)getFormattingTemplateWithNSString:(NSString *)numberPattern
                                   withNSString:(NSString *)numberFormat;

- (NSString *)inputDigitWithOptionToRememberPositionWithChar:(jchar)nextChar
                                                 withBoolean:(jboolean)rememberPosition;

- (NSString *)attemptToChoosePatternWithPrefixExtracted;

- (jboolean)ableToExtractLongerNdd;

- (jboolean)isDigitOrLeadingPlusSignWithChar:(jchar)nextChar;

/*!
 @brief Combines the national number with any prefix (IDD/+ and country code or national prefix) that
 was collected.
 A space will be inserted between them if the current formatting template
 indicates this to be suitable.
 */
- (NSString *)appendNationalNumberWithNSString:(NSString *)nationalNumber;

/*!
 @brief Attempts to set the formatting template and returns a string which contains the formatted
 version of the digits entered so far.
 */
- (NSString *)attemptToChooseFormattingPattern;

/*!
 @brief Invokes inputDigitHelper on each digit of the national number accrued, and returns a formatted
 string in the end.
 */
- (NSString *)inputAccruedNationalNumber;

/*!
 @brief Returns true if the current country is a NANPA country and the national number begins with
 the national prefix.
 */
- (jboolean)isNanpaNumberWithNationalPrefix;

- (NSString *)removeNationalPrefixFromNationalNumber;

/*!
 @brief Extracts IDD and plus sign to prefixBeforeNationalNumber when they are available, and places
 the remaining input into nationalNumber.
 @return true when accruedInputWithoutFormatting begins with the plus sign or valid IDD for
 defaultCountry.
 */
- (jboolean)attemptToExtractIdd;

/*!
 @brief Extracts the country calling code from the beginning of nationalNumber to
 prefixBeforeNationalNumber when they are available, and places the remaining input into
 nationalNumber.
 @return true when a valid country calling code can be found.
 */
- (jboolean)attemptToExtractCountryCallingCode;

- (jchar)normalizeAndAccrueDigitsAndPlusSignWithChar:(jchar)nextChar
                                         withBoolean:(jboolean)rememberPosition;

- (NSString *)inputDigitHelperWithChar:(jchar)nextChar;

@end

J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, currentOutput_, NSString *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, formattingTemplate_, JavaLangStringBuilder *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, currentFormattingPattern_, NSString *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, accruedInput_, JavaLangStringBuilder *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, accruedInputWithoutFormatting_, JavaLangStringBuilder *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, phoneUtil_, ComGoogleI18nPhonenumbersPhoneNumberUtil *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, defaultCountry_, NSString *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, defaultMetadata_, ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, currentMetadata_, ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, prefixBeforeNationalNumber_, JavaLangStringBuilder *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, extractedNationalPrefix_, NSString *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, nationalNumber_, JavaLangStringBuilder *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, possibleFormats_, id<JavaUtilList>)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersAsYouTypeFormatter, regexCache_, ComGoogleI18nPhonenumbersInternalRegexCache *)

inline jchar ComGoogleI18nPhonenumbersAsYouTypeFormatter_get_SEPARATOR_BEFORE_NATIONAL_NUMBER();
#define ComGoogleI18nPhonenumbersAsYouTypeFormatter_SEPARATOR_BEFORE_NATIONAL_NUMBER ' '
J2OBJC_STATIC_FIELD_CONSTANT(ComGoogleI18nPhonenumbersAsYouTypeFormatter, SEPARATOR_BEFORE_NATIONAL_NUMBER, jchar)

inline ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *ComGoogleI18nPhonenumbersAsYouTypeFormatter_get_EMPTY_METADATA();
static ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *ComGoogleI18nPhonenumbersAsYouTypeFormatter_EMPTY_METADATA;
J2OBJC_STATIC_FIELD_OBJ_FINAL(ComGoogleI18nPhonenumbersAsYouTypeFormatter, EMPTY_METADATA, ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *)

inline JavaUtilRegexPattern *ComGoogleI18nPhonenumbersAsYouTypeFormatter_get_CHARACTER_CLASS_PATTERN();
static JavaUtilRegexPattern *ComGoogleI18nPhonenumbersAsYouTypeFormatter_CHARACTER_CLASS_PATTERN;
J2OBJC_STATIC_FIELD_OBJ_FINAL(ComGoogleI18nPhonenumbersAsYouTypeFormatter, CHARACTER_CLASS_PATTERN, JavaUtilRegexPattern *)

inline JavaUtilRegexPattern *ComGoogleI18nPhonenumbersAsYouTypeFormatter_get_STANDALONE_DIGIT_PATTERN();
static JavaUtilRegexPattern *ComGoogleI18nPhonenumbersAsYouTypeFormatter_STANDALONE_DIGIT_PATTERN;
J2OBJC_STATIC_FIELD_OBJ_FINAL(ComGoogleI18nPhonenumbersAsYouTypeFormatter, STANDALONE_DIGIT_PATTERN, JavaUtilRegexPattern *)

inline JavaUtilRegexPattern *ComGoogleI18nPhonenumbersAsYouTypeFormatter_get_ELIGIBLE_FORMAT_PATTERN();
static JavaUtilRegexPattern *ComGoogleI18nPhonenumbersAsYouTypeFormatter_ELIGIBLE_FORMAT_PATTERN;
J2OBJC_STATIC_FIELD_OBJ_FINAL(ComGoogleI18nPhonenumbersAsYouTypeFormatter, ELIGIBLE_FORMAT_PATTERN, JavaUtilRegexPattern *)

inline JavaUtilRegexPattern *ComGoogleI18nPhonenumbersAsYouTypeFormatter_get_NATIONAL_PREFIX_SEPARATORS_PATTERN();
static JavaUtilRegexPattern *ComGoogleI18nPhonenumbersAsYouTypeFormatter_NATIONAL_PREFIX_SEPARATORS_PATTERN;
J2OBJC_STATIC_FIELD_OBJ_FINAL(ComGoogleI18nPhonenumbersAsYouTypeFormatter, NATIONAL_PREFIX_SEPARATORS_PATTERN, JavaUtilRegexPattern *)

inline jint ComGoogleI18nPhonenumbersAsYouTypeFormatter_get_MIN_LEADING_DIGITS_LENGTH();
#define ComGoogleI18nPhonenumbersAsYouTypeFormatter_MIN_LEADING_DIGITS_LENGTH 3
J2OBJC_STATIC_FIELD_CONSTANT(ComGoogleI18nPhonenumbersAsYouTypeFormatter, MIN_LEADING_DIGITS_LENGTH, jint)

inline NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_get_DIGIT_PLACEHOLDER();
static NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_DIGIT_PLACEHOLDER = @"\u2008";
J2OBJC_STATIC_FIELD_OBJ_FINAL(ComGoogleI18nPhonenumbersAsYouTypeFormatter, DIGIT_PLACEHOLDER, NSString *)

inline JavaUtilRegexPattern *ComGoogleI18nPhonenumbersAsYouTypeFormatter_get_DIGIT_PATTERN();
static JavaUtilRegexPattern *ComGoogleI18nPhonenumbersAsYouTypeFormatter_DIGIT_PATTERN;
J2OBJC_STATIC_FIELD_OBJ_FINAL(ComGoogleI18nPhonenumbersAsYouTypeFormatter, DIGIT_PATTERN, JavaUtilRegexPattern *)

__attribute__((unused)) static ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *ComGoogleI18nPhonenumbersAsYouTypeFormatter_getMetadataForRegionWithNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *regionCode);

__attribute__((unused)) static jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_maybeCreateNewTemplate(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self);

__attribute__((unused)) static void ComGoogleI18nPhonenumbersAsYouTypeFormatter_getAvailableFormatsWithNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *leadingDigits);

__attribute__((unused)) static jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_isFormatEligibleWithNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *format);

__attribute__((unused)) static void ComGoogleI18nPhonenumbersAsYouTypeFormatter_narrowDownPossibleFormatsWithNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *leadingDigits);

__attribute__((unused)) static jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_createFormattingTemplateWithComGoogleI18nPhonenumbersPhonemetadata_NumberFormat_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat *format);

__attribute__((unused)) static NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_getFormattingTemplateWithNSString_withNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *numberPattern, NSString *numberFormat);

__attribute__((unused)) static NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputDigitWithOptionToRememberPositionWithChar_withBoolean_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, jchar nextChar, jboolean rememberPosition);

__attribute__((unused)) static NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToChoosePatternWithPrefixExtracted(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self);

__attribute__((unused)) static jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_ableToExtractLongerNdd(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self);

__attribute__((unused)) static jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_isDigitOrLeadingPlusSignWithChar_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, jchar nextChar);

__attribute__((unused)) static NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_appendNationalNumberWithNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *nationalNumber);

__attribute__((unused)) static NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToChooseFormattingPattern(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self);

__attribute__((unused)) static NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputAccruedNationalNumber(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self);

__attribute__((unused)) static jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_isNanpaNumberWithNationalPrefix(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self);

__attribute__((unused)) static NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_removeNationalPrefixFromNationalNumber(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self);

__attribute__((unused)) static jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToExtractIdd(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self);

__attribute__((unused)) static jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToExtractCountryCallingCode(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self);

__attribute__((unused)) static jchar ComGoogleI18nPhonenumbersAsYouTypeFormatter_normalizeAndAccrueDigitsAndPlusSignWithChar_withBoolean_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, jchar nextChar, jboolean rememberPosition);

__attribute__((unused)) static NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputDigitHelperWithChar_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, jchar nextChar);

J2OBJC_INITIALIZED_DEFN(ComGoogleI18nPhonenumbersAsYouTypeFormatter)

@implementation ComGoogleI18nPhonenumbersAsYouTypeFormatter

- (instancetype)initWithNSString:(NSString *)regionCode {
  ComGoogleI18nPhonenumbersAsYouTypeFormatter_initWithNSString_(self, regionCode);
  return self;
}

- (ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *)getMetadataForRegionWithNSString:(NSString *)regionCode {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_getMetadataForRegionWithNSString_(self, regionCode);
}

- (jboolean)maybeCreateNewTemplate {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_maybeCreateNewTemplate(self);
}

- (void)getAvailableFormatsWithNSString:(NSString *)leadingDigits {
  ComGoogleI18nPhonenumbersAsYouTypeFormatter_getAvailableFormatsWithNSString_(self, leadingDigits);
}

- (jboolean)isFormatEligibleWithNSString:(NSString *)format {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_isFormatEligibleWithNSString_(self, format);
}

- (void)narrowDownPossibleFormatsWithNSString:(NSString *)leadingDigits {
  ComGoogleI18nPhonenumbersAsYouTypeFormatter_narrowDownPossibleFormatsWithNSString_(self, leadingDigits);
}

- (jboolean)createFormattingTemplateWithComGoogleI18nPhonenumbersPhonemetadata_NumberFormat:(ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat *)format {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_createFormattingTemplateWithComGoogleI18nPhonenumbersPhonemetadata_NumberFormat_(self, format);
}

- (NSString *)getFormattingTemplateWithNSString:(NSString *)numberPattern
                                   withNSString:(NSString *)numberFormat {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_getFormattingTemplateWithNSString_withNSString_(self, numberPattern, numberFormat);
}

- (void)clear {
  JreStrongAssign(&currentOutput_, @"");
  [((JavaLangStringBuilder *) nil_chk(accruedInput_)) setLengthWithInt:0];
  [((JavaLangStringBuilder *) nil_chk(accruedInputWithoutFormatting_)) setLengthWithInt:0];
  [((JavaLangStringBuilder *) nil_chk(formattingTemplate_)) setLengthWithInt:0];
  lastMatchPosition_ = 0;
  JreStrongAssign(&currentFormattingPattern_, @"");
  [((JavaLangStringBuilder *) nil_chk(prefixBeforeNationalNumber_)) setLengthWithInt:0];
  JreStrongAssign(&extractedNationalPrefix_, @"");
  [((JavaLangStringBuilder *) nil_chk(nationalNumber_)) setLengthWithInt:0];
  ableToFormat_ = true;
  inputHasFormatting_ = false;
  positionToRemember_ = 0;
  originalPosition_ = 0;
  isCompleteNumber_ = false;
  isExpectingCountryCallingCode_ = false;
  [((id<JavaUtilList>) nil_chk(possibleFormats_)) clear];
  shouldAddSpaceAfterNationalPrefix_ = false;
  if (![((ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *) nil_chk(currentMetadata_)) isEqual:defaultMetadata_]) {
    JreStrongAssign(&currentMetadata_, ComGoogleI18nPhonenumbersAsYouTypeFormatter_getMetadataForRegionWithNSString_(self, defaultCountry_));
  }
}

- (NSString *)inputDigitWithChar:(jchar)nextChar {
  JreStrongAssign(&currentOutput_, ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputDigitWithOptionToRememberPositionWithChar_withBoolean_(self, nextChar, false));
  return currentOutput_;
}

- (NSString *)inputDigitAndRememberPositionWithChar:(jchar)nextChar {
  JreStrongAssign(&currentOutput_, ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputDigitWithOptionToRememberPositionWithChar_withBoolean_(self, nextChar, true));
  return currentOutput_;
}

- (NSString *)inputDigitWithOptionToRememberPositionWithChar:(jchar)nextChar
                                                 withBoolean:(jboolean)rememberPosition {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputDigitWithOptionToRememberPositionWithChar_withBoolean_(self, nextChar, rememberPosition);
}

- (NSString *)attemptToChoosePatternWithPrefixExtracted {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToChoosePatternWithPrefixExtracted(self);
}

- (NSString *)getExtractedNationalPrefix {
  return extractedNationalPrefix_;
}

- (jboolean)ableToExtractLongerNdd {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_ableToExtractLongerNdd(self);
}

- (jboolean)isDigitOrLeadingPlusSignWithChar:(jchar)nextChar {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_isDigitOrLeadingPlusSignWithChar_(self, nextChar);
}

- (NSString *)attemptToFormatAccruedDigits {
  for (ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat * __strong numberFormat in nil_chk(possibleFormats_)) {
    JavaUtilRegexMatcher *m = [((JavaUtilRegexPattern *) nil_chk([((ComGoogleI18nPhonenumbersInternalRegexCache *) nil_chk(regexCache_)) getPatternForRegexWithNSString:[((ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat *) nil_chk(numberFormat)) getPattern]])) matcherWithJavaLangCharSequence:nationalNumber_];
    if ([((JavaUtilRegexMatcher *) nil_chk(m)) matches]) {
      shouldAddSpaceAfterNationalPrefix_ = [((JavaUtilRegexMatcher *) nil_chk([((JavaUtilRegexPattern *) nil_chk(ComGoogleI18nPhonenumbersAsYouTypeFormatter_NATIONAL_PREFIX_SEPARATORS_PATTERN)) matcherWithJavaLangCharSequence:[numberFormat getNationalPrefixFormattingRule]])) find];
      NSString *formattedNumber = [m replaceAllWithNSString:[numberFormat getFormat]];
      return ComGoogleI18nPhonenumbersAsYouTypeFormatter_appendNationalNumberWithNSString_(self, formattedNumber);
    }
  }
  return @"";
}

- (jint)getRememberedPosition {
  if (!ableToFormat_) {
    return originalPosition_;
  }
  jint accruedInputIndex = 0;
  jint currentOutputIndex = 0;
  while (accruedInputIndex < positionToRemember_ && currentOutputIndex < ((jint) [((NSString *) nil_chk(currentOutput_)) length])) {
    if ([((JavaLangStringBuilder *) nil_chk(accruedInputWithoutFormatting_)) charAtWithInt:accruedInputIndex] == [((NSString *) nil_chk(currentOutput_)) charAtWithInt:currentOutputIndex]) {
      accruedInputIndex++;
    }
    currentOutputIndex++;
  }
  return currentOutputIndex;
}

- (NSString *)appendNationalNumberWithNSString:(NSString *)nationalNumber {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_appendNationalNumberWithNSString_(self, nationalNumber);
}

- (NSString *)attemptToChooseFormattingPattern {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToChooseFormattingPattern(self);
}

- (NSString *)inputAccruedNationalNumber {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputAccruedNationalNumber(self);
}

- (jboolean)isNanpaNumberWithNationalPrefix {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_isNanpaNumberWithNationalPrefix(self);
}

- (NSString *)removeNationalPrefixFromNationalNumber {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_removeNationalPrefixFromNationalNumber(self);
}

- (jboolean)attemptToExtractIdd {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToExtractIdd(self);
}

- (jboolean)attemptToExtractCountryCallingCode {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToExtractCountryCallingCode(self);
}

- (jchar)normalizeAndAccrueDigitsAndPlusSignWithChar:(jchar)nextChar
                                         withBoolean:(jboolean)rememberPosition {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_normalizeAndAccrueDigitsAndPlusSignWithChar_withBoolean_(self, nextChar, rememberPosition);
}

- (NSString *)inputDigitHelperWithChar:(jchar)nextChar {
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputDigitHelperWithChar_(self, nextChar);
}

- (void)dealloc {
  RELEASE_(currentOutput_);
  RELEASE_(formattingTemplate_);
  RELEASE_(currentFormattingPattern_);
  RELEASE_(accruedInput_);
  RELEASE_(accruedInputWithoutFormatting_);
  RELEASE_(phoneUtil_);
  RELEASE_(defaultCountry_);
  RELEASE_(defaultMetadata_);
  RELEASE_(currentMetadata_);
  RELEASE_(prefixBeforeNationalNumber_);
  RELEASE_(extractedNationalPrefix_);
  RELEASE_(nationalNumber_);
  RELEASE_(possibleFormats_);
  RELEASE_(regexCache_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, 0, -1, -1, -1, -1 },
    { NULL, "LComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata;", 0x2, 1, 0, -1, -1, -1, -1 },
    { NULL, "Z", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 2, 0, -1, -1, -1, -1 },
    { NULL, "Z", 0x2, 3, 0, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 4, 0, -1, -1, -1, -1 },
    { NULL, "Z", 0x2, 5, 6, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x2, 7, 8, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x1, 9, 10, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x1, 11, 10, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x2, 12, 13, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x2, 14, 10, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x2, 15, 0, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "C", 0x2, 16, 13, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x2, 17, 10, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithNSString:);
  methods[1].selector = @selector(getMetadataForRegionWithNSString:);
  methods[2].selector = @selector(maybeCreateNewTemplate);
  methods[3].selector = @selector(getAvailableFormatsWithNSString:);
  methods[4].selector = @selector(isFormatEligibleWithNSString:);
  methods[5].selector = @selector(narrowDownPossibleFormatsWithNSString:);
  methods[6].selector = @selector(createFormattingTemplateWithComGoogleI18nPhonenumbersPhonemetadata_NumberFormat:);
  methods[7].selector = @selector(getFormattingTemplateWithNSString:withNSString:);
  methods[8].selector = @selector(clear);
  methods[9].selector = @selector(inputDigitWithChar:);
  methods[10].selector = @selector(inputDigitAndRememberPositionWithChar:);
  methods[11].selector = @selector(inputDigitWithOptionToRememberPositionWithChar:withBoolean:);
  methods[12].selector = @selector(attemptToChoosePatternWithPrefixExtracted);
  methods[13].selector = @selector(getExtractedNationalPrefix);
  methods[14].selector = @selector(ableToExtractLongerNdd);
  methods[15].selector = @selector(isDigitOrLeadingPlusSignWithChar:);
  methods[16].selector = @selector(attemptToFormatAccruedDigits);
  methods[17].selector = @selector(getRememberedPosition);
  methods[18].selector = @selector(appendNationalNumberWithNSString:);
  methods[19].selector = @selector(attemptToChooseFormattingPattern);
  methods[20].selector = @selector(inputAccruedNationalNumber);
  methods[21].selector = @selector(isNanpaNumberWithNationalPrefix);
  methods[22].selector = @selector(removeNationalPrefixFromNationalNumber);
  methods[23].selector = @selector(attemptToExtractIdd);
  methods[24].selector = @selector(attemptToExtractCountryCallingCode);
  methods[25].selector = @selector(normalizeAndAccrueDigitsAndPlusSignWithChar:withBoolean:);
  methods[26].selector = @selector(inputDigitHelperWithChar:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "currentOutput_", "LNSString;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "formattingTemplate_", "LJavaLangStringBuilder;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "currentFormattingPattern_", "LNSString;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "accruedInput_", "LJavaLangStringBuilder;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "accruedInputWithoutFormatting_", "LJavaLangStringBuilder;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "ableToFormat_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "inputHasFormatting_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "isCompleteNumber_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "isExpectingCountryCallingCode_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "phoneUtil_", "LComGoogleI18nPhonenumbersPhoneNumberUtil;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "defaultCountry_", "LNSString;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "SEPARATOR_BEFORE_NATIONAL_NUMBER", "C", .constantValue.asUnichar = ComGoogleI18nPhonenumbersAsYouTypeFormatter_SEPARATOR_BEFORE_NATIONAL_NUMBER, 0x1a, -1, -1, -1, -1 },
    { "EMPTY_METADATA", "LComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata;", .constantValue.asLong = 0, 0x1a, -1, 18, -1, -1 },
    { "defaultMetadata_", "LComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "currentMetadata_", "LComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "CHARACTER_CLASS_PATTERN", "LJavaUtilRegexPattern;", .constantValue.asLong = 0, 0x1a, -1, 19, -1, -1 },
    { "STANDALONE_DIGIT_PATTERN", "LJavaUtilRegexPattern;", .constantValue.asLong = 0, 0x1a, -1, 20, -1, -1 },
    { "ELIGIBLE_FORMAT_PATTERN", "LJavaUtilRegexPattern;", .constantValue.asLong = 0, 0x1a, -1, 21, -1, -1 },
    { "NATIONAL_PREFIX_SEPARATORS_PATTERN", "LJavaUtilRegexPattern;", .constantValue.asLong = 0, 0x1a, -1, 22, -1, -1 },
    { "MIN_LEADING_DIGITS_LENGTH", "I", .constantValue.asInt = ComGoogleI18nPhonenumbersAsYouTypeFormatter_MIN_LEADING_DIGITS_LENGTH, 0x1a, -1, -1, -1, -1 },
    { "DIGIT_PLACEHOLDER", "LNSString;", .constantValue.asLong = 0, 0x1a, -1, 23, -1, -1 },
    { "DIGIT_PATTERN", "LJavaUtilRegexPattern;", .constantValue.asLong = 0, 0x1a, -1, 24, -1, -1 },
    { "lastMatchPosition_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "originalPosition_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "positionToRemember_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "prefixBeforeNationalNumber_", "LJavaLangStringBuilder;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "shouldAddSpaceAfterNationalPrefix_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "extractedNationalPrefix_", "LNSString;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "nationalNumber_", "LJavaLangStringBuilder;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "possibleFormats_", "LJavaUtilList;", .constantValue.asLong = 0, 0x2, -1, -1, 25, -1 },
    { "regexCache_", "LComGoogleI18nPhonenumbersInternalRegexCache;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LNSString;", "getMetadataForRegion", "getAvailableFormats", "isFormatEligible", "narrowDownPossibleFormats", "createFormattingTemplate", "LComGoogleI18nPhonenumbersPhonemetadata_NumberFormat;", "getFormattingTemplate", "LNSString;LNSString;", "inputDigit", "C", "inputDigitAndRememberPosition", "inputDigitWithOptionToRememberPosition", "CZ", "isDigitOrLeadingPlusSign", "appendNationalNumber", "normalizeAndAccrueDigitsAndPlusSign", "inputDigitHelper", &ComGoogleI18nPhonenumbersAsYouTypeFormatter_EMPTY_METADATA, &ComGoogleI18nPhonenumbersAsYouTypeFormatter_CHARACTER_CLASS_PATTERN, &ComGoogleI18nPhonenumbersAsYouTypeFormatter_STANDALONE_DIGIT_PATTERN, &ComGoogleI18nPhonenumbersAsYouTypeFormatter_ELIGIBLE_FORMAT_PATTERN, &ComGoogleI18nPhonenumbersAsYouTypeFormatter_NATIONAL_PREFIX_SEPARATORS_PATTERN, &ComGoogleI18nPhonenumbersAsYouTypeFormatter_DIGIT_PLACEHOLDER, &ComGoogleI18nPhonenumbersAsYouTypeFormatter_DIGIT_PATTERN, "Ljava/util/List<Lcom/google/i18n/phonenumbers/Phonemetadata$NumberFormat;>;" };
  static const J2ObjcClassInfo _ComGoogleI18nPhonenumbersAsYouTypeFormatter = { "AsYouTypeFormatter", "com.google.i18n.phonenumbers", ptrTable, methods, fields, 7, 0x1, 27, 31, -1, -1, -1, -1, -1 };
  return &_ComGoogleI18nPhonenumbersAsYouTypeFormatter;
}

+ (void)initialize {
  if (self == [ComGoogleI18nPhonenumbersAsYouTypeFormatter class]) {
    JreStrongAssign(&ComGoogleI18nPhonenumbersAsYouTypeFormatter_EMPTY_METADATA, [create_ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata_init() setInternationalPrefixWithNSString:@"NA"]);
    JreStrongAssign(&ComGoogleI18nPhonenumbersAsYouTypeFormatter_CHARACTER_CLASS_PATTERN, JavaUtilRegexPattern_compileWithNSString_(@"\\[([^\\[\\]])*\\]"));
    JreStrongAssign(&ComGoogleI18nPhonenumbersAsYouTypeFormatter_STANDALONE_DIGIT_PATTERN, JavaUtilRegexPattern_compileWithNSString_(@"\\d(?=[^,}][^,}])"));
    JreStrongAssign(&ComGoogleI18nPhonenumbersAsYouTypeFormatter_ELIGIBLE_FORMAT_PATTERN, JavaUtilRegexPattern_compileWithNSString_(JreStrcat("C$$$$", '[', ComGoogleI18nPhonenumbersPhoneNumberUtil_VALID_PUNCTUATION, @"]*(\\$\\d[", ComGoogleI18nPhonenumbersPhoneNumberUtil_VALID_PUNCTUATION, @"]*)+")));
    JreStrongAssign(&ComGoogleI18nPhonenumbersAsYouTypeFormatter_NATIONAL_PREFIX_SEPARATORS_PATTERN, JavaUtilRegexPattern_compileWithNSString_(@"[- ]"));
    JreStrongAssign(&ComGoogleI18nPhonenumbersAsYouTypeFormatter_DIGIT_PATTERN, JavaUtilRegexPattern_compileWithNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter_DIGIT_PLACEHOLDER));
    J2OBJC_SET_INITIALIZED(ComGoogleI18nPhonenumbersAsYouTypeFormatter)
  }
}

@end

void ComGoogleI18nPhonenumbersAsYouTypeFormatter_initWithNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *regionCode) {
  NSObject_init(self);
  JreStrongAssign(&self->currentOutput_, @"");
  JreStrongAssignAndConsume(&self->formattingTemplate_, new_JavaLangStringBuilder_init());
  JreStrongAssign(&self->currentFormattingPattern_, @"");
  JreStrongAssignAndConsume(&self->accruedInput_, new_JavaLangStringBuilder_init());
  JreStrongAssignAndConsume(&self->accruedInputWithoutFormatting_, new_JavaLangStringBuilder_init());
  self->ableToFormat_ = true;
  self->inputHasFormatting_ = false;
  self->isCompleteNumber_ = false;
  self->isExpectingCountryCallingCode_ = false;
  JreStrongAssign(&self->phoneUtil_, ComGoogleI18nPhonenumbersPhoneNumberUtil_getInstance());
  self->lastMatchPosition_ = 0;
  self->originalPosition_ = 0;
  self->positionToRemember_ = 0;
  JreStrongAssignAndConsume(&self->prefixBeforeNationalNumber_, new_JavaLangStringBuilder_init());
  self->shouldAddSpaceAfterNationalPrefix_ = false;
  JreStrongAssign(&self->extractedNationalPrefix_, @"");
  JreStrongAssignAndConsume(&self->nationalNumber_, new_JavaLangStringBuilder_init());
  JreStrongAssignAndConsume(&self->possibleFormats_, new_JavaUtilArrayList_init());
  JreStrongAssignAndConsume(&self->regexCache_, new_ComGoogleI18nPhonenumbersInternalRegexCache_initWithInt_(64));
  JreStrongAssign(&self->defaultCountry_, regionCode);
  JreStrongAssign(&self->currentMetadata_, ComGoogleI18nPhonenumbersAsYouTypeFormatter_getMetadataForRegionWithNSString_(self, self->defaultCountry_));
  JreStrongAssign(&self->defaultMetadata_, self->currentMetadata_);
}

ComGoogleI18nPhonenumbersAsYouTypeFormatter *new_ComGoogleI18nPhonenumbersAsYouTypeFormatter_initWithNSString_(NSString *regionCode) {
  J2OBJC_NEW_IMPL(ComGoogleI18nPhonenumbersAsYouTypeFormatter, initWithNSString_, regionCode)
}

ComGoogleI18nPhonenumbersAsYouTypeFormatter *create_ComGoogleI18nPhonenumbersAsYouTypeFormatter_initWithNSString_(NSString *regionCode) {
  J2OBJC_CREATE_IMPL(ComGoogleI18nPhonenumbersAsYouTypeFormatter, initWithNSString_, regionCode)
}

ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *ComGoogleI18nPhonenumbersAsYouTypeFormatter_getMetadataForRegionWithNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *regionCode) {
  jint countryCallingCode = [((ComGoogleI18nPhonenumbersPhoneNumberUtil *) nil_chk(self->phoneUtil_)) getCountryCodeForRegionWithNSString:regionCode];
  NSString *mainCountry = [self->phoneUtil_ getRegionCodeForCountryCodeWithInt:countryCallingCode];
  ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *metadata = [self->phoneUtil_ getMetadataForRegionWithNSString:mainCountry];
  if (metadata != nil) {
    return metadata;
  }
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_EMPTY_METADATA;
}

jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_maybeCreateNewTemplate(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self) {
  id<JavaUtilIterator> it = [((id<JavaUtilList>) nil_chk(self->possibleFormats_)) iterator];
  while ([((id<JavaUtilIterator>) nil_chk(it)) hasNext]) {
    ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat *numberFormat = [it next];
    NSString *pattern = [((ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat *) nil_chk(numberFormat)) getPattern];
    if ([((NSString *) nil_chk(self->currentFormattingPattern_)) isEqual:pattern]) {
      return false;
    }
    if (ComGoogleI18nPhonenumbersAsYouTypeFormatter_createFormattingTemplateWithComGoogleI18nPhonenumbersPhonemetadata_NumberFormat_(self, numberFormat)) {
      JreStrongAssign(&self->currentFormattingPattern_, pattern);
      self->shouldAddSpaceAfterNationalPrefix_ = [((JavaUtilRegexMatcher *) nil_chk([((JavaUtilRegexPattern *) nil_chk(ComGoogleI18nPhonenumbersAsYouTypeFormatter_NATIONAL_PREFIX_SEPARATORS_PATTERN)) matcherWithJavaLangCharSequence:[numberFormat getNationalPrefixFormattingRule]])) find];
      self->lastMatchPosition_ = 0;
      return true;
    }
    else {
      [it remove];
    }
  }
  self->ableToFormat_ = false;
  return false;
}

void ComGoogleI18nPhonenumbersAsYouTypeFormatter_getAvailableFormatsWithNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *leadingDigits) {
  id<JavaUtilList> formatList = (self->isCompleteNumber_ && [((ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *) nil_chk(self->currentMetadata_)) intlNumberFormatSize] > 0) ? [((ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *) nil_chk(self->currentMetadata_)) intlNumberFormats] : [((ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *) nil_chk(self->currentMetadata_)) numberFormats];
  jboolean nationalPrefixIsUsedByCountry = [((ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *) nil_chk(self->currentMetadata_)) hasNationalPrefix];
  for (ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat * __strong format in formatList) {
    if (!nationalPrefixIsUsedByCountry || self->isCompleteNumber_ || [((ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat *) nil_chk(format)) getNationalPrefixOptionalWhenFormatting] || ComGoogleI18nPhonenumbersPhoneNumberUtil_formattingRuleHasFirstGroupOnlyWithNSString_([format getNationalPrefixFormattingRule])) {
      if (ComGoogleI18nPhonenumbersAsYouTypeFormatter_isFormatEligibleWithNSString_(self, [((ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat *) nil_chk(format)) getFormat])) {
        [((id<JavaUtilList>) nil_chk(self->possibleFormats_)) addWithId:format];
      }
    }
  }
  ComGoogleI18nPhonenumbersAsYouTypeFormatter_narrowDownPossibleFormatsWithNSString_(self, leadingDigits);
}

jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_isFormatEligibleWithNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *format) {
  return [((JavaUtilRegexMatcher *) nil_chk([((JavaUtilRegexPattern *) nil_chk(ComGoogleI18nPhonenumbersAsYouTypeFormatter_ELIGIBLE_FORMAT_PATTERN)) matcherWithJavaLangCharSequence:format])) matches];
}

void ComGoogleI18nPhonenumbersAsYouTypeFormatter_narrowDownPossibleFormatsWithNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *leadingDigits) {
  jint indexOfLeadingDigitsPattern = ((jint) [((NSString *) nil_chk(leadingDigits)) length]) - ComGoogleI18nPhonenumbersAsYouTypeFormatter_MIN_LEADING_DIGITS_LENGTH;
  id<JavaUtilIterator> it = [((id<JavaUtilList>) nil_chk(self->possibleFormats_)) iterator];
  while ([((id<JavaUtilIterator>) nil_chk(it)) hasNext]) {
    ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat *format = [it next];
    if ([((ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat *) nil_chk(format)) leadingDigitsPatternSize] == 0) {
      continue;
    }
    jint lastLeadingDigitsPattern = JavaLangMath_minWithInt_withInt_(indexOfLeadingDigitsPattern, [format leadingDigitsPatternSize] - 1);
    JavaUtilRegexPattern *leadingDigitsPattern = [((ComGoogleI18nPhonenumbersInternalRegexCache *) nil_chk(self->regexCache_)) getPatternForRegexWithNSString:[format getLeadingDigitsPatternWithInt:lastLeadingDigitsPattern]];
    JavaUtilRegexMatcher *m = [((JavaUtilRegexPattern *) nil_chk(leadingDigitsPattern)) matcherWithJavaLangCharSequence:leadingDigits];
    if (![((JavaUtilRegexMatcher *) nil_chk(m)) lookingAt]) {
      [it remove];
    }
  }
}

jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_createFormattingTemplateWithComGoogleI18nPhonenumbersPhonemetadata_NumberFormat_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat *format) {
  NSString *numberPattern = [((ComGoogleI18nPhonenumbersPhonemetadata_NumberFormat *) nil_chk(format)) getPattern];
  if ([((NSString *) nil_chk(numberPattern)) indexOf:'|'] != -1) {
    return false;
  }
  numberPattern = [((JavaUtilRegexMatcher *) nil_chk([((JavaUtilRegexPattern *) nil_chk(ComGoogleI18nPhonenumbersAsYouTypeFormatter_CHARACTER_CLASS_PATTERN)) matcherWithJavaLangCharSequence:numberPattern])) replaceAllWithNSString:@"\\\\d"];
  numberPattern = [((JavaUtilRegexMatcher *) nil_chk([((JavaUtilRegexPattern *) nil_chk(ComGoogleI18nPhonenumbersAsYouTypeFormatter_STANDALONE_DIGIT_PATTERN)) matcherWithJavaLangCharSequence:numberPattern])) replaceAllWithNSString:@"\\\\d"];
  [((JavaLangStringBuilder *) nil_chk(self->formattingTemplate_)) setLengthWithInt:0];
  NSString *tempTemplate = ComGoogleI18nPhonenumbersAsYouTypeFormatter_getFormattingTemplateWithNSString_withNSString_(self, numberPattern, [format getFormat]);
  if (((jint) [((NSString *) nil_chk(tempTemplate)) length]) > 0) {
    [((JavaLangStringBuilder *) nil_chk(self->formattingTemplate_)) appendWithNSString:tempTemplate];
    return true;
  }
  return false;
}

NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_getFormattingTemplateWithNSString_withNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *numberPattern, NSString *numberFormat) {
  NSString *longestPhoneNumber = @"999999999999999";
  JavaUtilRegexMatcher *m = [((JavaUtilRegexPattern *) nil_chk([((ComGoogleI18nPhonenumbersInternalRegexCache *) nil_chk(self->regexCache_)) getPatternForRegexWithNSString:numberPattern])) matcherWithJavaLangCharSequence:longestPhoneNumber];
  [((JavaUtilRegexMatcher *) nil_chk(m)) find];
  NSString *aPhoneNumber = [m group];
  if (((jint) [((NSString *) nil_chk(aPhoneNumber)) length]) < [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) length]) {
    return @"";
  }
  NSString *template_ = [aPhoneNumber replaceAll:numberPattern withReplacement:numberFormat];
  template_ = [((NSString *) nil_chk(template_)) replaceAll:@"9" withReplacement:ComGoogleI18nPhonenumbersAsYouTypeFormatter_DIGIT_PLACEHOLDER];
  return template_;
}

NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputDigitWithOptionToRememberPositionWithChar_withBoolean_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, jchar nextChar, jboolean rememberPosition) {
  [((JavaLangStringBuilder *) nil_chk(self->accruedInput_)) appendWithChar:nextChar];
  if (rememberPosition) {
    self->originalPosition_ = [((JavaLangStringBuilder *) nil_chk(self->accruedInput_)) length];
  }
  if (!ComGoogleI18nPhonenumbersAsYouTypeFormatter_isDigitOrLeadingPlusSignWithChar_(self, nextChar)) {
    self->ableToFormat_ = false;
    self->inputHasFormatting_ = true;
  }
  else {
    nextChar = ComGoogleI18nPhonenumbersAsYouTypeFormatter_normalizeAndAccrueDigitsAndPlusSignWithChar_withBoolean_(self, nextChar, rememberPosition);
  }
  if (!self->ableToFormat_) {
    if (self->inputHasFormatting_) {
      return [((JavaLangStringBuilder *) nil_chk(self->accruedInput_)) description];
    }
    else if (ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToExtractIdd(self)) {
      if (ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToExtractCountryCallingCode(self)) {
        return ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToChoosePatternWithPrefixExtracted(self);
      }
    }
    else if (ComGoogleI18nPhonenumbersAsYouTypeFormatter_ableToExtractLongerNdd(self)) {
      [((JavaLangStringBuilder *) nil_chk(self->prefixBeforeNationalNumber_)) appendWithChar:ComGoogleI18nPhonenumbersAsYouTypeFormatter_SEPARATOR_BEFORE_NATIONAL_NUMBER];
      return ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToChoosePatternWithPrefixExtracted(self);
    }
    return [((JavaLangStringBuilder *) nil_chk(self->accruedInput_)) description];
  }
  switch ([((JavaLangStringBuilder *) nil_chk(self->accruedInputWithoutFormatting_)) length]) {
    case 0:
    case 1:
    case 2:
    return [((JavaLangStringBuilder *) nil_chk(self->accruedInput_)) description];
    case 3:
    if (ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToExtractIdd(self)) {
      self->isExpectingCountryCallingCode_ = true;
    }
    else {
      JreStrongAssign(&self->extractedNationalPrefix_, ComGoogleI18nPhonenumbersAsYouTypeFormatter_removeNationalPrefixFromNationalNumber(self));
      return ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToChooseFormattingPattern(self);
    }
    default:
    if (self->isExpectingCountryCallingCode_) {
      if (ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToExtractCountryCallingCode(self)) {
        self->isExpectingCountryCallingCode_ = false;
      }
      return JreStrcat("@$", self->prefixBeforeNationalNumber_, [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) description]);
    }
    if ([((id<JavaUtilList>) nil_chk(self->possibleFormats_)) size] > 0) {
      NSString *tempNationalNumber = ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputDigitHelperWithChar_(self, nextChar);
      NSString *formattedNumber = [self attemptToFormatAccruedDigits];
      if (((jint) [((NSString *) nil_chk(formattedNumber)) length]) > 0) {
        return formattedNumber;
      }
      ComGoogleI18nPhonenumbersAsYouTypeFormatter_narrowDownPossibleFormatsWithNSString_(self, [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) description]);
      if (ComGoogleI18nPhonenumbersAsYouTypeFormatter_maybeCreateNewTemplate(self)) {
        return ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputAccruedNationalNumber(self);
      }
      return self->ableToFormat_ ? ComGoogleI18nPhonenumbersAsYouTypeFormatter_appendNationalNumberWithNSString_(self, tempNationalNumber) : [((JavaLangStringBuilder *) nil_chk(self->accruedInput_)) description];
    }
    else {
      return ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToChooseFormattingPattern(self);
    }
  }
}

NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToChoosePatternWithPrefixExtracted(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self) {
  self->ableToFormat_ = true;
  self->isExpectingCountryCallingCode_ = false;
  [((id<JavaUtilList>) nil_chk(self->possibleFormats_)) clear];
  self->lastMatchPosition_ = 0;
  [((JavaLangStringBuilder *) nil_chk(self->formattingTemplate_)) setLengthWithInt:0];
  JreStrongAssign(&self->currentFormattingPattern_, @"");
  return ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToChooseFormattingPattern(self);
}

jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_ableToExtractLongerNdd(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self) {
  if (((jint) [((NSString *) nil_chk(self->extractedNationalPrefix_)) length]) > 0) {
    [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) insertWithInt:0 withNSString:self->extractedNationalPrefix_];
    jint indexOfPreviousNdd = [((JavaLangStringBuilder *) nil_chk(self->prefixBeforeNationalNumber_)) lastIndexOfWithNSString:self->extractedNationalPrefix_];
    [((JavaLangStringBuilder *) nil_chk(self->prefixBeforeNationalNumber_)) setLengthWithInt:indexOfPreviousNdd];
  }
  return ![((NSString *) nil_chk(self->extractedNationalPrefix_)) isEqual:ComGoogleI18nPhonenumbersAsYouTypeFormatter_removeNationalPrefixFromNationalNumber(self)];
}

jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_isDigitOrLeadingPlusSignWithChar_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, jchar nextChar) {
  return JavaLangCharacter_isDigitWithChar_(nextChar) || ([((JavaLangStringBuilder *) nil_chk(self->accruedInput_)) length] == 1 && [((JavaUtilRegexMatcher *) nil_chk([((JavaUtilRegexPattern *) nil_chk(JreLoadStatic(ComGoogleI18nPhonenumbersPhoneNumberUtil, PLUS_CHARS_PATTERN))) matcherWithJavaLangCharSequence:JavaLangCharacter_toStringWithChar_(nextChar)])) matches]);
}

NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_appendNationalNumberWithNSString_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, NSString *nationalNumber) {
  jint prefixBeforeNationalNumberLength = [((JavaLangStringBuilder *) nil_chk(self->prefixBeforeNationalNumber_)) length];
  if (self->shouldAddSpaceAfterNationalPrefix_ && prefixBeforeNationalNumberLength > 0 && [((JavaLangStringBuilder *) nil_chk(self->prefixBeforeNationalNumber_)) charAtWithInt:prefixBeforeNationalNumberLength - 1] != ComGoogleI18nPhonenumbersAsYouTypeFormatter_SEPARATOR_BEFORE_NATIONAL_NUMBER) {
    return JreStrcat("$C$", [NSString stringWithJavaLangStringBuilder:self->prefixBeforeNationalNumber_], ComGoogleI18nPhonenumbersAsYouTypeFormatter_SEPARATOR_BEFORE_NATIONAL_NUMBER, nationalNumber);
  }
  else {
    return JreStrcat("@$", self->prefixBeforeNationalNumber_, nationalNumber);
  }
}

NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToChooseFormattingPattern(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self) {
  if ([((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) length] >= ComGoogleI18nPhonenumbersAsYouTypeFormatter_MIN_LEADING_DIGITS_LENGTH) {
    ComGoogleI18nPhonenumbersAsYouTypeFormatter_getAvailableFormatsWithNSString_(self, [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) description]);
    NSString *formattedNumber = [self attemptToFormatAccruedDigits];
    if (((jint) [((NSString *) nil_chk(formattedNumber)) length]) > 0) {
      return formattedNumber;
    }
    return ComGoogleI18nPhonenumbersAsYouTypeFormatter_maybeCreateNewTemplate(self) ? ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputAccruedNationalNumber(self) : [((JavaLangStringBuilder *) nil_chk(self->accruedInput_)) description];
  }
  else {
    return ComGoogleI18nPhonenumbersAsYouTypeFormatter_appendNationalNumberWithNSString_(self, [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) description]);
  }
}

NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputAccruedNationalNumber(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self) {
  jint lengthOfNationalNumber = [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) length];
  if (lengthOfNationalNumber > 0) {
    NSString *tempNationalNumber = @"";
    for (jint i = 0; i < lengthOfNationalNumber; i++) {
      tempNationalNumber = ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputDigitHelperWithChar_(self, [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) charAtWithInt:i]);
    }
    return self->ableToFormat_ ? ComGoogleI18nPhonenumbersAsYouTypeFormatter_appendNationalNumberWithNSString_(self, tempNationalNumber) : [((JavaLangStringBuilder *) nil_chk(self->accruedInput_)) description];
  }
  else {
    return [((JavaLangStringBuilder *) nil_chk(self->prefixBeforeNationalNumber_)) description];
  }
}

jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_isNanpaNumberWithNationalPrefix(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self) {
  return ([((ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *) nil_chk(self->currentMetadata_)) getCountryCode] == 1) && ([((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) charAtWithInt:0] == '1') && ([((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) charAtWithInt:1] != '0') && ([((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) charAtWithInt:1] != '1');
}

NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_removeNationalPrefixFromNationalNumber(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self) {
  jint startOfNationalNumber = 0;
  if (ComGoogleI18nPhonenumbersAsYouTypeFormatter_isNanpaNumberWithNationalPrefix(self)) {
    startOfNationalNumber = 1;
    [((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk(self->prefixBeforeNationalNumber_)) appendWithChar:'1'])) appendWithChar:ComGoogleI18nPhonenumbersAsYouTypeFormatter_SEPARATOR_BEFORE_NATIONAL_NUMBER];
    self->isCompleteNumber_ = true;
  }
  else if ([((ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *) nil_chk(self->currentMetadata_)) hasNationalPrefixForParsing]) {
    JavaUtilRegexPattern *nationalPrefixForParsing = [((ComGoogleI18nPhonenumbersInternalRegexCache *) nil_chk(self->regexCache_)) getPatternForRegexWithNSString:[((ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *) nil_chk(self->currentMetadata_)) getNationalPrefixForParsing]];
    JavaUtilRegexMatcher *m = [((JavaUtilRegexPattern *) nil_chk(nationalPrefixForParsing)) matcherWithJavaLangCharSequence:self->nationalNumber_];
    if ([((JavaUtilRegexMatcher *) nil_chk(m)) lookingAt] && [m end] > 0) {
      self->isCompleteNumber_ = true;
      startOfNationalNumber = [m end];
      [((JavaLangStringBuilder *) nil_chk(self->prefixBeforeNationalNumber_)) appendWithNSString:[((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) substringWithInt:0 withInt:startOfNationalNumber]];
    }
  }
  NSString *nationalPrefix = [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) substringWithInt:0 withInt:startOfNationalNumber];
  [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) delete__WithInt:0 withInt:startOfNationalNumber];
  return nationalPrefix;
}

jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToExtractIdd(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self) {
  JavaUtilRegexPattern *internationalPrefix = [((ComGoogleI18nPhonenumbersInternalRegexCache *) nil_chk(self->regexCache_)) getPatternForRegexWithNSString:JreStrcat("CCC$", '\\', ComGoogleI18nPhonenumbersPhoneNumberUtil_PLUS_SIGN, '|', [((ComGoogleI18nPhonenumbersPhonemetadata_PhoneMetadata *) nil_chk(self->currentMetadata_)) getInternationalPrefix])];
  JavaUtilRegexMatcher *iddMatcher = [((JavaUtilRegexPattern *) nil_chk(internationalPrefix)) matcherWithJavaLangCharSequence:self->accruedInputWithoutFormatting_];
  if ([((JavaUtilRegexMatcher *) nil_chk(iddMatcher)) lookingAt]) {
    self->isCompleteNumber_ = true;
    jint startOfCountryCallingCode = [iddMatcher end];
    [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) setLengthWithInt:0];
    [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) appendWithNSString:[((JavaLangStringBuilder *) nil_chk(self->accruedInputWithoutFormatting_)) substringWithInt:startOfCountryCallingCode]];
    [((JavaLangStringBuilder *) nil_chk(self->prefixBeforeNationalNumber_)) setLengthWithInt:0];
    [((JavaLangStringBuilder *) nil_chk(self->prefixBeforeNationalNumber_)) appendWithNSString:[((JavaLangStringBuilder *) nil_chk(self->accruedInputWithoutFormatting_)) substringWithInt:0 withInt:startOfCountryCallingCode]];
    if ([((JavaLangStringBuilder *) nil_chk(self->accruedInputWithoutFormatting_)) charAtWithInt:0] != ComGoogleI18nPhonenumbersPhoneNumberUtil_PLUS_SIGN) {
      [((JavaLangStringBuilder *) nil_chk(self->prefixBeforeNationalNumber_)) appendWithChar:ComGoogleI18nPhonenumbersAsYouTypeFormatter_SEPARATOR_BEFORE_NATIONAL_NUMBER];
    }
    return true;
  }
  return false;
}

jboolean ComGoogleI18nPhonenumbersAsYouTypeFormatter_attemptToExtractCountryCallingCode(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self) {
  if ([((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) length] == 0) {
    return false;
  }
  JavaLangStringBuilder *numberWithoutCountryCallingCode = create_JavaLangStringBuilder_init();
  jint countryCode = [((ComGoogleI18nPhonenumbersPhoneNumberUtil *) nil_chk(self->phoneUtil_)) extractCountryCodeWithJavaLangStringBuilder:self->nationalNumber_ withJavaLangStringBuilder:numberWithoutCountryCallingCode];
  if (countryCode == 0) {
    return false;
  }
  [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) setLengthWithInt:0];
  [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) appendWithJavaLangCharSequence:numberWithoutCountryCallingCode];
  NSString *newRegionCode = [self->phoneUtil_ getRegionCodeForCountryCodeWithInt:countryCode];
  if ([((NSString *) nil_chk(ComGoogleI18nPhonenumbersPhoneNumberUtil_REGION_CODE_FOR_NON_GEO_ENTITY)) isEqual:newRegionCode]) {
    JreStrongAssign(&self->currentMetadata_, [self->phoneUtil_ getMetadataForNonGeographicalRegionWithInt:countryCode]);
  }
  else if (![((NSString *) nil_chk(newRegionCode)) isEqual:self->defaultCountry_]) {
    JreStrongAssign(&self->currentMetadata_, ComGoogleI18nPhonenumbersAsYouTypeFormatter_getMetadataForRegionWithNSString_(self, newRegionCode));
  }
  NSString *countryCodeString = JavaLangInteger_toStringWithInt_(countryCode);
  [((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk(self->prefixBeforeNationalNumber_)) appendWithNSString:countryCodeString])) appendWithChar:ComGoogleI18nPhonenumbersAsYouTypeFormatter_SEPARATOR_BEFORE_NATIONAL_NUMBER];
  JreStrongAssign(&self->extractedNationalPrefix_, @"");
  return true;
}

jchar ComGoogleI18nPhonenumbersAsYouTypeFormatter_normalizeAndAccrueDigitsAndPlusSignWithChar_withBoolean_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, jchar nextChar, jboolean rememberPosition) {
  jchar normalizedChar;
  if (nextChar == ComGoogleI18nPhonenumbersPhoneNumberUtil_PLUS_SIGN) {
    normalizedChar = nextChar;
    [((JavaLangStringBuilder *) nil_chk(self->accruedInputWithoutFormatting_)) appendWithChar:nextChar];
  }
  else {
    jint radix = 10;
    normalizedChar = JavaLangCharacter_forDigitWithInt_withInt_(JavaLangCharacter_digitWithChar_withInt_(nextChar, radix), radix);
    [((JavaLangStringBuilder *) nil_chk(self->accruedInputWithoutFormatting_)) appendWithChar:normalizedChar];
    [((JavaLangStringBuilder *) nil_chk(self->nationalNumber_)) appendWithChar:normalizedChar];
  }
  if (rememberPosition) {
    self->positionToRemember_ = [((JavaLangStringBuilder *) nil_chk(self->accruedInputWithoutFormatting_)) length];
  }
  return normalizedChar;
}

NSString *ComGoogleI18nPhonenumbersAsYouTypeFormatter_inputDigitHelperWithChar_(ComGoogleI18nPhonenumbersAsYouTypeFormatter *self, jchar nextChar) {
  JavaUtilRegexMatcher *digitMatcher = [((JavaUtilRegexPattern *) nil_chk(ComGoogleI18nPhonenumbersAsYouTypeFormatter_DIGIT_PATTERN)) matcherWithJavaLangCharSequence:self->formattingTemplate_];
  if ([((JavaUtilRegexMatcher *) nil_chk(digitMatcher)) findWithInt:self->lastMatchPosition_]) {
    NSString *tempTemplate = [digitMatcher replaceFirstWithNSString:JavaLangCharacter_toStringWithChar_(nextChar)];
    [((JavaLangStringBuilder *) nil_chk(self->formattingTemplate_)) replaceWithInt:0 withInt:((jint) [((NSString *) nil_chk(tempTemplate)) length]) withNSString:tempTemplate];
    self->lastMatchPosition_ = [digitMatcher start];
    return [((JavaLangStringBuilder *) nil_chk(self->formattingTemplate_)) substringWithInt:0 withInt:self->lastMatchPosition_ + 1];
  }
  else {
    if ([((id<JavaUtilList>) nil_chk(self->possibleFormats_)) size] == 1) {
      self->ableToFormat_ = false;
    }
    JreStrongAssign(&self->currentFormattingPattern_, @"");
    return [((JavaLangStringBuilder *) nil_chk(self->accruedInput_)) description];
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComGoogleI18nPhonenumbersAsYouTypeFormatter)
