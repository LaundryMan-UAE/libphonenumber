//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/andrefonseca/Documents/PodsFolders/libphonenumber/java/libphonenumber/src/main/java/com/google/i18n/phonenumbers/SingleFileMetadataSourceImpl.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "com/google/i18n/phonenumbers/MetadataLoader.h"
#include "com/google/i18n/phonenumbers/MetadataManager.h"
#include "com/google/i18n/phonenumbers/PhoneNumberUtil.h"
#include "com/google/i18n/phonenumbers/SingleFileMetadataSourceImpl.h"
#include "com/google/i18n/phonenumbers/nano/Phonemetadata.h"
#include "com/google/protobuf/nano/CodedInputByteBufferNano.h"
#include "java/io/IOException.h"
#include "java/io/InputStream.h"
#include "java/io/ObjectInputStream.h"
#include "java/lang/IllegalStateException.h"
#include "java/lang/Integer.h"
#include "java/lang/RuntimeException.h"
#include "java/util/Collections.h"
#include "java/util/HashMap.h"
#include "java/util/Map.h"
#include "java/util/logging/Level.h"
#include "java/util/logging/Logger.h"

@interface ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl () {
 @public
  id<JavaUtilMap> regionToMetadataMap_;
  id<JavaUtilMap> countryCodeToNonGeographicalMetadataMap_;
  NSString *fileName_;
  id<ComGoogleI18nPhonenumbersMetadataLoader> metadataLoader_;
}

/*!
 @brief Loads the metadata protocol buffer from the given stream and closes the stream afterwards.
 Any
 exceptions that occur while reading or closing the stream are ignored.
 @param source  the non-null stream from which metadata is to be read.
 @return the loaded metadata protocol buffer.
 */
+ (ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadataCollection *)loadMetadataAndCloseInputWithJavaIoObjectInputStream:(JavaIoObjectInputStream *)source;

@end

J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl, regionToMetadataMap_, id<JavaUtilMap>)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl, countryCodeToNonGeographicalMetadataMap_, id<JavaUtilMap>)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl, fileName_, NSString *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl, metadataLoader_, id<ComGoogleI18nPhonenumbersMetadataLoader>)

inline JavaUtilLoggingLogger *ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_get_logger();
static JavaUtilLoggingLogger *ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_logger;
J2OBJC_STATIC_FIELD_OBJ_FINAL(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl, logger, JavaUtilLoggingLogger *)

inline NSString *ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_get_META_DATA_FILE_NAME();
static NSString *ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_META_DATA_FILE_NAME = @"SingleFilePhoneNumberMetadataProto";
J2OBJC_STATIC_FIELD_OBJ_FINAL(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl, META_DATA_FILE_NAME, NSString *)

__attribute__((unused)) static ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadataCollection *ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_loadMetadataAndCloseInputWithJavaIoObjectInputStream_(JavaIoObjectInputStream *source);

J2OBJC_INITIALIZED_DEFN(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl)

@implementation ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl

- (instancetype)initWithNSString:(NSString *)fileName
withComGoogleI18nPhonenumbersMetadataLoader:(id<ComGoogleI18nPhonenumbersMetadataLoader>)metadataLoader {
  ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_initWithNSString_withComGoogleI18nPhonenumbersMetadataLoader_(self, fileName, metadataLoader);
  return self;
}

- (instancetype)initWithComGoogleI18nPhonenumbersMetadataLoader:(id<ComGoogleI18nPhonenumbersMetadataLoader>)metadataLoader {
  ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_initWithComGoogleI18nPhonenumbersMetadataLoader_(self, metadataLoader);
  return self;
}

- (ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadata *)getMetadataForRegionWithNSString:(NSString *)regionCode {
  @synchronized(regionToMetadataMap_) {
    if (![((id<JavaUtilMap>) nil_chk(regionToMetadataMap_)) containsKeyWithId:regionCode]) {
      [self loadMetadataFromFile];
    }
  }
  return [regionToMetadataMap_ getWithId:regionCode];
}

- (ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadata *)getMetadataForNonGeographicalRegionWithInt:(jint)countryCallingCode {
  @synchronized(countryCodeToNonGeographicalMetadataMap_) {
    if (![((id<JavaUtilMap>) nil_chk(countryCodeToNonGeographicalMetadataMap_)) containsKeyWithId:JavaLangInteger_valueOfWithInt_(countryCallingCode)]) {
      [self loadMetadataFromFile];
    }
  }
  return [countryCodeToNonGeographicalMetadataMap_ getWithId:JavaLangInteger_valueOfWithInt_(countryCallingCode)];
}

- (void)loadMetadataFromFile {
  JavaIoInputStream *source = [((id<ComGoogleI18nPhonenumbersMetadataLoader>) nil_chk(metadataLoader_)) loadMetadataWithNSString:fileName_];
  if (source == nil) {
    [((JavaUtilLoggingLogger *) nil_chk(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_logger)) logWithJavaUtilLoggingLevel:JreLoadStatic(JavaUtilLoggingLevel, SEVERE) withNSString:JreStrcat("$$", @"missing metadata: ", fileName_)];
    @throw create_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"missing metadata: ", fileName_));
  }
  @try {
    ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadataCollection *metadataCollection = ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_loadMetadataAndCloseInputWithJavaIoObjectInputStream_(create_JavaIoObjectInputStream_initWithJavaIoInputStream_(source));
    IOSObjectArray *metadataList = ((ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadataCollection *) nil_chk(metadataCollection))->metadata_;
    if (((IOSObjectArray *) nil_chk(metadataList))->size_ == 0) {
      [((JavaUtilLoggingLogger *) nil_chk(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_logger)) logWithJavaUtilLoggingLevel:JreLoadStatic(JavaUtilLoggingLevel, SEVERE) withNSString:JreStrcat("$$", @"empty metadata: ", fileName_)];
      @throw create_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", @"empty metadata: ", fileName_));
    }
    {
      IOSObjectArray *a__ = metadataList;
      ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadata * const *b__ = a__->buffer_;
      ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadata * const *e__ = b__ + a__->size_;
      while (b__ < e__) {
        ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadata *metadata = *b__++;
        NSString *regionCode = ((ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadata *) nil_chk(metadata))->id__;
        jint countryCallingCode = metadata->countryCode_;
        jboolean isNonGeoRegion = [((NSString *) nil_chk(ComGoogleI18nPhonenumbersPhoneNumberUtil_REGION_CODE_FOR_NON_GEO_ENTITY)) isEqual:regionCode];
        if (isNonGeoRegion) {
          [((id<JavaUtilMap>) nil_chk(countryCodeToNonGeographicalMetadataMap_)) putWithId:JavaLangInteger_valueOfWithInt_(countryCallingCode) withId:metadata];
        }
        else {
          [((id<JavaUtilMap>) nil_chk(regionToMetadataMap_)) putWithId:regionCode withId:metadata];
        }
      }
    }
  }
  @catch (JavaIoIOException *e) {
    [((JavaUtilLoggingLogger *) nil_chk(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_logger)) logWithJavaUtilLoggingLevel:JreLoadStatic(JavaUtilLoggingLevel, SEVERE) withNSString:JreStrcat("$$", @"cannot load/parse metadata: ", fileName_) withNSException:e];
    @throw create_JavaLangRuntimeException_initWithNSString_withNSException_(JreStrcat("$$", @"cannot load/parse metadata: ", fileName_), e);
  }
}

+ (ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadataCollection *)loadMetadataAndCloseInputWithJavaIoObjectInputStream:(JavaIoObjectInputStream *)source {
  return ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_loadMetadataAndCloseInputWithJavaIoObjectInputStream_(source);
}

- (void)dealloc {
  RELEASE_(regionToMetadataMap_);
  RELEASE_(countryCodeToNonGeographicalMetadataMap_);
  RELEASE_(fileName_);
  RELEASE_(metadataLoader_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 1, -1, -1, -1, -1 },
    { NULL, "LComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadata;", 0x1, 2, 3, -1, -1, -1, -1 },
    { NULL, "LComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadata;", 0x1, 4, 5, -1, -1, -1, -1 },
    { NULL, "V", 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "LComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadataCollection;", 0xa, 6, 7, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithNSString:withComGoogleI18nPhonenumbersMetadataLoader:);
  methods[1].selector = @selector(initWithComGoogleI18nPhonenumbersMetadataLoader:);
  methods[2].selector = @selector(getMetadataForRegionWithNSString:);
  methods[3].selector = @selector(getMetadataForNonGeographicalRegionWithInt:);
  methods[4].selector = @selector(loadMetadataFromFile);
  methods[5].selector = @selector(loadMetadataAndCloseInputWithJavaIoObjectInputStream:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "logger", "LJavaUtilLoggingLogger;", .constantValue.asLong = 0, 0x1a, -1, 8, -1, -1 },
    { "META_DATA_FILE_NAME", "LNSString;", .constantValue.asLong = 0, 0x1a, -1, 9, -1, -1 },
    { "regionToMetadataMap_", "LJavaUtilMap;", .constantValue.asLong = 0, 0x12, -1, -1, 10, -1 },
    { "countryCodeToNonGeographicalMetadataMap_", "LJavaUtilMap;", .constantValue.asLong = 0, 0x12, -1, -1, 11, -1 },
    { "fileName_", "LNSString;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "metadataLoader_", "LComGoogleI18nPhonenumbersMetadataLoader;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LNSString;LComGoogleI18nPhonenumbersMetadataLoader;", "LComGoogleI18nPhonenumbersMetadataLoader;", "getMetadataForRegion", "LNSString;", "getMetadataForNonGeographicalRegion", "I", "loadMetadataAndCloseInput", "LJavaIoObjectInputStream;", &ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_logger, &ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_META_DATA_FILE_NAME, "Ljava/util/Map<Ljava/lang/String;Lcom/google/i18n/phonenumbers/nano/Phonemetadata$PhoneMetadata;>;", "Ljava/util/Map<Ljava/lang/Integer;Lcom/google/i18n/phonenumbers/nano/Phonemetadata$PhoneMetadata;>;" };
  static const J2ObjcClassInfo _ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl = { "SingleFileMetadataSourceImpl", "com.google.i18n.phonenumbers", ptrTable, methods, fields, 7, 0x10, 6, 6, -1, -1, -1, -1, -1 };
  return &_ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl;
}

+ (void)initialize {
  if (self == [ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl class]) {
    JreStrongAssign(&ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_logger, JavaUtilLoggingLogger_getLoggerWithNSString_([ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_class_() getName]));
    J2OBJC_SET_INITIALIZED(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl)
  }
}

@end

void ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_initWithNSString_withComGoogleI18nPhonenumbersMetadataLoader_(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl *self, NSString *fileName, id<ComGoogleI18nPhonenumbersMetadataLoader> metadataLoader) {
  NSObject_init(self);
  JreStrongAssign(&self->regionToMetadataMap_, JavaUtilCollections_synchronizedMapWithJavaUtilMap_(create_JavaUtilHashMap_init()));
  JreStrongAssign(&self->countryCodeToNonGeographicalMetadataMap_, JavaUtilCollections_synchronizedMapWithJavaUtilMap_(create_JavaUtilHashMap_init()));
  JreStrongAssign(&self->fileName_, fileName);
  JreStrongAssign(&self->metadataLoader_, metadataLoader);
}

ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl *new_ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_initWithNSString_withComGoogleI18nPhonenumbersMetadataLoader_(NSString *fileName, id<ComGoogleI18nPhonenumbersMetadataLoader> metadataLoader) {
  J2OBJC_NEW_IMPL(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl, initWithNSString_withComGoogleI18nPhonenumbersMetadataLoader_, fileName, metadataLoader)
}

ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl *create_ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_initWithNSString_withComGoogleI18nPhonenumbersMetadataLoader_(NSString *fileName, id<ComGoogleI18nPhonenumbersMetadataLoader> metadataLoader) {
  J2OBJC_CREATE_IMPL(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl, initWithNSString_withComGoogleI18nPhonenumbersMetadataLoader_, fileName, metadataLoader)
}

void ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_initWithComGoogleI18nPhonenumbersMetadataLoader_(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl *self, id<ComGoogleI18nPhonenumbersMetadataLoader> metadataLoader) {
  ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_initWithNSString_withComGoogleI18nPhonenumbersMetadataLoader_(self, ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_META_DATA_FILE_NAME, metadataLoader);
}

ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl *new_ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_initWithComGoogleI18nPhonenumbersMetadataLoader_(id<ComGoogleI18nPhonenumbersMetadataLoader> metadataLoader) {
  J2OBJC_NEW_IMPL(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl, initWithComGoogleI18nPhonenumbersMetadataLoader_, metadataLoader)
}

ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl *create_ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_initWithComGoogleI18nPhonenumbersMetadataLoader_(id<ComGoogleI18nPhonenumbersMetadataLoader> metadataLoader) {
  J2OBJC_CREATE_IMPL(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl, initWithComGoogleI18nPhonenumbersMetadataLoader_, metadataLoader)
}

ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadataCollection *ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_loadMetadataAndCloseInputWithJavaIoObjectInputStream_(JavaIoObjectInputStream *source) {
  ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_initialize();
  jint SINGLE_FILE_BUFFER_SIZE = 256 * 1024;
  ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadataCollection *metadataCollection = create_ComGoogleI18nPhonenumbersNanoPhonemetadata_PhoneMetadataCollection_init();
  @try {
    [metadataCollection mergeFromWithComGoogleProtobufNanoCodedInputByteBufferNano:ComGoogleI18nPhonenumbersMetadataManager_convertStreamToByteBufferWithJavaIoObjectInputStream_withInt_(source, SINGLE_FILE_BUFFER_SIZE)];
  }
  @catch (JavaIoIOException *e) {
    [((JavaUtilLoggingLogger *) nil_chk(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_logger)) logWithJavaUtilLoggingLevel:JreLoadStatic(JavaUtilLoggingLevel, WARNING) withNSString:@"error reading input (ignored)" withNSException:e];
  }
  @finally {
    @try {
      [((JavaIoObjectInputStream *) nil_chk(source)) close];
    }
    @catch (JavaIoIOException *e) {
      [((JavaUtilLoggingLogger *) nil_chk(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl_logger)) logWithJavaUtilLoggingLevel:JreLoadStatic(JavaUtilLoggingLevel, WARNING) withNSString:@"error closing input stream (ignored)" withNSException:e];
    }
  }
  return metadataCollection;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComGoogleI18nPhonenumbersSingleFileMetadataSourceImpl)
