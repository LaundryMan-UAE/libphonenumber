//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/marcussmith/HambroPerks/hambroperks_org/libphonenumber/java/internal/prefixmapper/src/main/java/com/google/i18n/phonenumbers/prefixmapper/PhonePrefixMap.java
//

#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "com/google/i18n/phonenumbers/PhoneNumberUtil.h"
#include "com/google/i18n/phonenumbers/Phonenumber.h"
#include "com/google/i18n/phonenumbers/prefixmapper/DefaultMapStorage.h"
#include "com/google/i18n/phonenumbers/prefixmapper/FlyweightMapStorage.h"
#include "com/google/i18n/phonenumbers/prefixmapper/PhonePrefixMap.h"
#include "com/google/i18n/phonenumbers/prefixmapper/PhonePrefixMapStorageStrategy.h"
#include "java/io/ByteArrayOutputStream.h"
#include "java/io/IOException.h"
#include "java/io/ObjectInput.h"
#include "java/io/ObjectOutput.h"
#include "java/io/ObjectOutputStream.h"
#include "java/lang/Integer.h"
#include "java/lang/Long.h"
#include "java/util/SortedMap.h"
#include "java/util/SortedSet.h"
#include "java/util/TreeSet.h"
#include "java/util/logging/Logger.h"

@interface ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap () {
 @public
  ComGoogleI18nPhonenumbersPhoneNumberUtil *phoneUtil_;
  ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *phonePrefixMapStorage_;
}

/**
 @brief Gets the size of the provided phone prefix map storage.
 The map storage passed-in will be filled as a result.
 */
+ (jint)getSizeOfPhonePrefixMapStorageWithComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy:(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *)mapStorage
                                                                                       withJavaUtilSortedMap:(id<JavaUtilSortedMap>)phonePrefixMap;

- (ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *)createDefaultMapStorage;

- (ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *)createFlyweightMapStorage;

/**
 @brief Does a binary search for <code>value</code> in the provided array from <code>start</code> to <code>end</code> (inclusive).
 Returns the position if <code>value</code> is found; otherwise, returns the position which has the largest value that is less than <code>value</code> . This means if <code>value</code> is the smallest, -1 will be returned.
 */
- (jint)binarySearchWithInt:(jint)start
                    withInt:(jint)end
                   withLong:(jlong)value;

@end

J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap, phoneUtil_, ComGoogleI18nPhonenumbersPhoneNumberUtil *)
J2OBJC_FIELD_SETTER(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap, phonePrefixMapStorage_, ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *)

static JavaUtilLoggingLogger *ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_LOGGER_;
J2OBJC_STATIC_FIELD_GETTER(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap, LOGGER_, JavaUtilLoggingLogger *)

__attribute__((unused)) static jint ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_getSizeOfPhonePrefixMapStorageWithComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy_withJavaUtilSortedMap_(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *mapStorage, id<JavaUtilSortedMap> phonePrefixMap);

__attribute__((unused)) static ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_createDefaultMapStorage(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap *self);

__attribute__((unused)) static ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_createFlyweightMapStorage(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap *self);

__attribute__((unused)) static jint ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_binarySearchWithInt_withInt_withLong_(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap *self, jint start, jint end, jlong value);

J2OBJC_INITIALIZED_DEFN(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap)

@implementation ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap

- (ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *)getPhonePrefixMapStorage {
  return phonePrefixMapStorage_;
}

- (instancetype)init {
  ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_init(self);
  return self;
}

+ (jint)getSizeOfPhonePrefixMapStorageWithComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy:(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *)mapStorage
                                                                                       withJavaUtilSortedMap:(id<JavaUtilSortedMap>)phonePrefixMap {
  return ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_getSizeOfPhonePrefixMapStorageWithComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy_withJavaUtilSortedMap_(mapStorage, phonePrefixMap);
}

- (ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *)createDefaultMapStorage {
  return ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_createDefaultMapStorage(self);
}

- (ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *)createFlyweightMapStorage {
  return ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_createFlyweightMapStorage(self);
}

- (ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *)getSmallerMapStorageWithJavaUtilSortedMap:(id<JavaUtilSortedMap>)phonePrefixMap {
  @try {
    ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *flyweightMapStorage = ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_createFlyweightMapStorage(self);
    jint sizeOfFlyweightMapStorage = ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_getSizeOfPhonePrefixMapStorageWithComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy_withJavaUtilSortedMap_(flyweightMapStorage, phonePrefixMap);
    ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *defaultMapStorage = ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_createDefaultMapStorage(self);
    jint sizeOfDefaultMapStorage = ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_getSizeOfPhonePrefixMapStorageWithComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy_withJavaUtilSortedMap_(defaultMapStorage, phonePrefixMap);
    return sizeOfFlyweightMapStorage < sizeOfDefaultMapStorage ? flyweightMapStorage : defaultMapStorage;
  }
  @catch (JavaIoIOException *e) {
    [((JavaUtilLoggingLogger *) nil_chk(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_LOGGER_)) severeWithNSString:[((JavaIoIOException *) nil_chk(e)) getMessage]];
    return ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_createFlyweightMapStorage(self);
  }
}

- (void)readPhonePrefixMapWithJavaUtilSortedMap:(id<JavaUtilSortedMap>)sortedPhonePrefixMap {
  ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_set_phonePrefixMapStorage_(self, [self getSmallerMapStorageWithJavaUtilSortedMap:sortedPhonePrefixMap]);
}

- (void)readExternalWithJavaIoObjectInput:(id<JavaIoObjectInput>)objectInput {
  jboolean useFlyweightMapStorage = [((id<JavaIoObjectInput>) nil_chk(objectInput)) readBoolean];
  if (useFlyweightMapStorage) {
    ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_setAndConsume_phonePrefixMapStorage_(self, new_ComGoogleI18nPhonenumbersPrefixmapperFlyweightMapStorage_init());
  }
  else {
    ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_setAndConsume_phonePrefixMapStorage_(self, new_ComGoogleI18nPhonenumbersPrefixmapperDefaultMapStorage_init());
  }
  [((ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *) nil_chk(phonePrefixMapStorage_)) readExternalWithJavaIoObjectInput:objectInput];
}

- (void)writeExternalWithJavaIoObjectOutput:(id<JavaIoObjectOutput>)objectOutput {
  [((id<JavaIoObjectOutput>) nil_chk(objectOutput)) writeBooleanWithBoolean:[phonePrefixMapStorage_ isKindOfClass:[ComGoogleI18nPhonenumbersPrefixmapperFlyweightMapStorage class]]];
  [((ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *) nil_chk(phonePrefixMapStorage_)) writeExternalWithJavaIoObjectOutput:objectOutput];
}

- (NSString *)lookupWithLong:(jlong)number {
  jint numOfEntries = [((ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *) nil_chk(phonePrefixMapStorage_)) getNumOfEntries];
  if (numOfEntries == 0) {
    return nil;
  }
  jlong phonePrefix = number;
  jint currentIndex = numOfEntries - 1;
  id<JavaUtilSortedSet> currentSetOfLengths = [phonePrefixMapStorage_ getPossibleLengths];
  while ([((id<JavaUtilSortedSet>) nil_chk(currentSetOfLengths)) size] > 0) {
    JavaLangInteger *possibleLength = [currentSetOfLengths last];
    NSString *phonePrefixStr = NSString_valueOfLong_(phonePrefix);
    if (((jint) [((NSString *) nil_chk(phonePrefixStr)) length]) > [((JavaLangInteger *) nil_chk(possibleLength)) intValue]) {
      phonePrefix = JavaLangLong_parseLongWithNSString_([phonePrefixStr substring:0 endIndex:[possibleLength intValue]]);
    }
    currentIndex = ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_binarySearchWithInt_withInt_withLong_(self, 0, currentIndex, phonePrefix);
    if (currentIndex < 0) {
      return nil;
    }
    jint currentPrefix = [phonePrefixMapStorage_ getPrefixWithInt:currentIndex];
    if (phonePrefix == currentPrefix) {
      return [phonePrefixMapStorage_ getDescriptionWithInt:currentIndex];
    }
    currentSetOfLengths = [currentSetOfLengths headSetWithId:possibleLength];
  }
  return nil;
}

- (NSString *)lookupWithComGoogleI18nPhonenumbersPhonenumber_PhoneNumber:(ComGoogleI18nPhonenumbersPhonenumber_PhoneNumber *)number {
  jlong phonePrefix = JavaLangLong_parseLongWithNSString_(JreStrcat("I$", [((ComGoogleI18nPhonenumbersPhonenumber_PhoneNumber *) nil_chk(number)) getCountryCode], [((ComGoogleI18nPhonenumbersPhoneNumberUtil *) nil_chk(phoneUtil_)) getNationalSignificantNumberWithComGoogleI18nPhonenumbersPhonenumber_PhoneNumber:number]));
  return [self lookupWithLong:phonePrefix];
}

- (jint)binarySearchWithInt:(jint)start
                    withInt:(jint)end
                   withLong:(jlong)value {
  return ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_binarySearchWithInt_withInt_withLong_(self, start, end, value);
}

- (NSString *)description {
  return [((ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *) nil_chk(phonePrefixMapStorage_)) description];
}

- (void)dealloc {
  RELEASE_(phoneUtil_);
  RELEASE_(phonePrefixMapStorage_);
  [super dealloc];
}

+ (void)initialize {
  if (self == [ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap class]) {
    JreStrongAssign(&ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_LOGGER_, nil, JavaUtilLoggingLogger_getLoggerWithNSString_([ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_class_() getName]));
    J2OBJC_SET_INITIALIZED(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "getPhonePrefixMapStorage", NULL, "Lcom.google.i18n.phonenumbers.prefixmapper.PhonePrefixMapStorageStrategy;", 0x0, NULL, NULL },
    { "init", "PhonePrefixMap", NULL, 0x1, NULL, NULL },
    { "getSizeOfPhonePrefixMapStorageWithComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy:withJavaUtilSortedMap:", "getSizeOfPhonePrefixMapStorage", "I", 0xa, "Ljava.io.IOException;", NULL },
    { "createDefaultMapStorage", NULL, "Lcom.google.i18n.phonenumbers.prefixmapper.PhonePrefixMapStorageStrategy;", 0x2, NULL, NULL },
    { "createFlyweightMapStorage", NULL, "Lcom.google.i18n.phonenumbers.prefixmapper.PhonePrefixMapStorageStrategy;", 0x2, NULL, NULL },
    { "getSmallerMapStorageWithJavaUtilSortedMap:", "getSmallerMapStorage", "Lcom.google.i18n.phonenumbers.prefixmapper.PhonePrefixMapStorageStrategy;", 0x0, NULL, NULL },
    { "readPhonePrefixMapWithJavaUtilSortedMap:", "readPhonePrefixMap", "V", 0x1, NULL, NULL },
    { "readExternalWithJavaIoObjectInput:", "readExternal", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "writeExternalWithJavaIoObjectOutput:", "writeExternal", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "lookupWithLong:", "lookup", "Ljava.lang.String;", 0x0, NULL, NULL },
    { "lookupWithComGoogleI18nPhonenumbersPhonenumber_PhoneNumber:", "lookup", "Ljava.lang.String;", 0x1, NULL, NULL },
    { "binarySearchWithInt:withInt:withLong:", "binarySearch", "I", 0x2, NULL, NULL },
    { "description", "toString", "Ljava.lang.String;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "phoneUtil_", NULL, 0x12, "Lcom.google.i18n.phonenumbers.PhoneNumberUtil;", NULL, NULL,  },
    { "LOGGER_", NULL, 0x1a, "Ljava.util.logging.Logger;", &ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_LOGGER_, NULL,  },
    { "phonePrefixMapStorage_", NULL, 0x2, "Lcom.google.i18n.phonenumbers.prefixmapper.PhonePrefixMapStorageStrategy;", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap = { 2, "PhonePrefixMap", "com.google.i18n.phonenumbers.prefixmapper", NULL, 0x1, 13, methods, 3, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap;
}

@end

void ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_init(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap *self) {
  NSObject_init(self);
  ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_set_phoneUtil_(self, ComGoogleI18nPhonenumbersPhoneNumberUtil_getInstance());
}

ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap *new_ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_init() {
  ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap *self = [ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap alloc];
  ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_init(self);
  return self;
}

jint ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_getSizeOfPhonePrefixMapStorageWithComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy_withJavaUtilSortedMap_(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *mapStorage, id<JavaUtilSortedMap> phonePrefixMap) {
  ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_initialize();
  [((ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *) nil_chk(mapStorage)) readFromSortedMapWithJavaUtilSortedMap:phonePrefixMap];
  JavaIoByteArrayOutputStream *byteArrayOutputStream = [new_JavaIoByteArrayOutputStream_init() autorelease];
  JavaIoObjectOutputStream *objectOutputStream = [new_JavaIoObjectOutputStream_initWithJavaIoOutputStream_(byteArrayOutputStream) autorelease];
  [mapStorage writeExternalWithJavaIoObjectOutput:objectOutputStream];
  [objectOutputStream flush];
  jint sizeOfStorage = [byteArrayOutputStream size];
  [objectOutputStream close];
  return sizeOfStorage;
}

ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_createDefaultMapStorage(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap *self) {
  return [new_ComGoogleI18nPhonenumbersPrefixmapperDefaultMapStorage_init() autorelease];
}

ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_createFlyweightMapStorage(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap *self) {
  return [new_ComGoogleI18nPhonenumbersPrefixmapperFlyweightMapStorage_init() autorelease];
}

jint ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap_binarySearchWithInt_withInt_withLong_(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap *self, jint start, jint end, jlong value) {
  jint current = 0;
  while (start <= end) {
    current = URShift32((start + end), 1);
    jint currentValue = [((ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMapStorageStrategy *) nil_chk(self->phonePrefixMapStorage_)) getPrefixWithInt:current];
    if (currentValue == value) {
      return current;
    }
    else if (currentValue > value) {
      current--;
      end = current;
    }
    else {
      start = current + 1;
    }
  }
  return current;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComGoogleI18nPhonenumbersPrefixmapperPhonePrefixMap)
